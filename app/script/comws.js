'use strict';const co=require('./co.js'),isPromise=function(b){return!!b&&('object'==typeof b||'function'==typeof b)&&'function'==typeof b.then};function isGenerator(a){return a.constructor.name.endsWith('GeneratorFunction')}module.exports=class{constructor(){this.mws=[]}use(b){this.mws.push(b)}handleError(b,c,d){for(let e=d+1;e<this.mws.length;){const f=this.mws[e];if(3===f.length){const g=co.wrap(f);return g(b,c,()=>{})}e++}return process.stderr.write(c+'\n'),c}run(b){const c=d=>{if(d===this.mws.length)return Promise.resolve(!0);const e=this.mws[d],f=i=>{if(i)return this.handleError(b,i,d);const j=c(d+1);return isPromise(j)?j:j instanceof Error?Promise.reject(j):Promise.resolve(j)},g=isGenerator(e)?co.wrap(e):e;let h;try{h=2===g.length?g(b,f):g.call(b,f)}catch(i){return f(i)}return isPromise(h)?h.then(i=>{return i}).catch(i=>{return f(i)}):Promise.resolve(h)};return c(0)}};
//# sourceMappingURL=comws.js.map
