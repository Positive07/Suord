{"version":3,"sources":["context-menu.js"],"names":["CoMws","require","context","run","elm","click","menu","then","onContextmenu","e","electron","remote","Menu","x","y","target","template","length","preventDefault","stopPropagation","buildFromTemplate","popup","getCurrentWindow","catch","err","process","stderr","write","stack","exports","reset","use","mw","Error","activate","document","body","addEventListener","__test"],"mappings":"AAAA,aAEA,KAAMA,OAAQC,QAAQ,YAAR,CAAd,CACA,GAAIC,SAAU,GAAIF,MAAlB,CAGA,QAASG,IAAT,CAAaC,CAAb,CAAkBC,CAAlB,CAAyB,CACvB,KAAMC,KAAN,CACA,MAAOJ,SACJC,GADI,CACA,CAACG,MAAD,CAAOF,KAAP,CAAYC,OAAZ,CADA,EAEJE,IAFI,CAEC,IAAMD,CAFP,CAGR,CAED,QAASE,cAAT,CAAuBC,CAAvB,CAA0B,CACxB,KAAMC,GAAWT,QAAQ,UAAR,CAAjB,CACMU,EAASD,EAASC,MADxB,CAEMC,EAAOD,EAAOC,IAFpB,CAGMP,EAAQ,CAACQ,EAAGJ,EAAEI,CAAN,CAASC,EAAGL,EAAEK,CAAd,CAHd,CAIMV,EAAMK,EAAEM,MAJd,CAMAZ,IAAIC,CAAJ,CAASC,CAAT,EACGE,IADH,CACQS,GAAY,CAChB,GAAsB,CAAlB,GAASC,MAAb,CAAyB,CACvBR,EAAES,cAAF,EADuB,CAEvBT,EAAEU,eAAF,EAFuB,CAIvB,KAAMb,GAAOM,EAAKQ,iBAAL,CAAuBJ,CAAvB,CAAb,CACAV,EAAKe,KAAL,CAAWV,EAAOW,gBAAP,EAAX,CAAsCjB,EAAMQ,CAA5C,CAA+CR,EAAMS,CAArD,CACD,CAEF,CAVH,EAWGS,KAXH,CAWSC,GAAOC,QAAQC,MAAR,CAAeC,KAAf,CAAqBH,EAAII,KAAJ,CAAY,IAAjC,CAXhB,CAYD,CAEDC,QAAQC,KAAR,CAAgB,UAAiB,CAC/B5B,QAAU,GAAIF,MACf,C,CAED6B,QAAQE,GAAR,CAAc,SAAaC,CAAb,CAAiB,CAC7B,GAAkB,UAAd,QAAOA,EAAX,CACE,KAAM,IAAIC,MAAJ,CAAU,wCAAV,CAAN,CAGF,MADA/B,SAAQ6B,GAAR,CAAYC,CAAZ,CACA,CAAOA,CACR,C,CAEDH,QAAQK,QAAR,CAAmB,UAAoB,CACjCC,SAASC,IADwB,CAEnCD,SAASC,IAAT,CAAcC,gBAAd,CAA+B,aAA/B,CAA8C7B,aAA9C,CAFmC,CAInC2B,SAASE,gBAAT,CAA0B,kBAA1B,CAA8C,IAAM,CAClDF,SAASC,IAAT,CAAcC,gBAAd,CAA+B,aAA/B,CAA8C7B,aAA9C,CACD,CAFD,CAKH,C,CAEDqB,QAAQS,MAAR,CAAiB,CAAEnC,GAAF,C","file":"context-menu.js","sourcesContent":["'use strict';\n\nconst CoMws = require('./comws.js');\nlet context = new CoMws();\n\n\nfunction run(elm, click) {\n  const menu = [];\n  return context\n    .run({menu, elm, click})\n    .then(() => menu);\n}\n\nfunction onContextmenu(e) {\n  const electron = require('electron');\n  const remote = electron.remote;\n  const Menu = remote.Menu;\n  const click = {x: e.x, y: e.y};\n  const elm = e.target;\n\n  run(elm, click)\n    .then(template => {\n      if (template.length > 0) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const menu = Menu.buildFromTemplate(template);\n        menu.popup(remote.getCurrentWindow(), click.x, click.y);\n      }\n\n    })\n    .catch(err => process.stderr.write(err.stack + '\\n'));\n}\n\nexports.reset = function reset() {\n  context = new CoMws();\n};\n\nexports.use = function use(mw) {\n  if (typeof mw !== 'function') {\n    throw new Error('Function middleware argument required.');\n  }\n  context.use(mw);\n  return mw;\n};\n\nexports.activate = function activate() {\n  if (document.body) {\n    document.body.addEventListener('contextmenu', onContextmenu);\n  } else {\n    document.addEventListener('DOMContentLoaded', () => {\n      document.body.addEventListener('contextmenu', onContextmenu);\n    });\n  }\n\n};\n\nexports.__test = { run };\n"]}